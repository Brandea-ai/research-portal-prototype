<div class="dashboard">
  @if (loading()) {
    <p class="loading">Daten werden geladen...</p>
  } @else {
    <div class="kpi-grid">
      <div class="kpi-card">
        <span class="kpi-card__label">Reports</span>
        <span class="kpi-card__value">{{ reports().length }}</span>
      </div>
      <div class="kpi-card">
        <span class="kpi-card__label">Wertschriften</span>
        <span class="kpi-card__value">{{ securities().length }}</span>
      </div>
      <div class="kpi-card">
        <span class="kpi-card__label">Analysten</span>
        <span class="kpi-card__value">{{ analysts().length }}</span>
      </div>
      <div class="kpi-card">
        <span class="kpi-card__label">Rating-Änderungen</span>
        <span class="kpi-card__value kpi-card__value--accent">
          {{ ratingChangedCount() }}
        </span>
      </div>
    </div>

    <section class="section">
      <h2 class="section__title">Neueste Reports</h2>
      <div class="report-list">
        @for (report of latestReports; track report.id) {
          <div class="report-row">
            <div class="report-row__info">
              <span class="report-row__title">{{ report.title }}</span>
              <span class="report-row__meta">
                {{ report.reportType }} · {{ report.publishedAt | date:'dd.MM.yyyy' }}
              </span>
            </div>
            <div class="report-row__data">
              <span class="report-row__rating" [class]="'rating--' + ratingClass(report.rating)">
                {{ report.rating.replace('_', ' ') }}
              </span>
              <span class="report-row__target">
                CHF {{ report.targetPrice | number:'1.2-2' }}
              </span>
            </div>
          </div>
        }
      </div>
    </section>
  }
</div>
