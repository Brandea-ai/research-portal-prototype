# ==============================================================================
# Research Portal - SonarQube Konfiguration
# ==============================================================================
#
# Banking Research Portal für Schweizer Bank (ZKB)
# Multi-Modul-Projekt: Spring Boot Backend + Angular Frontend
#
# Verwendung:
#   - Standalone: sonar-scanner (wenn SonarQube Scanner CLI installiert)
#   - Maven:      mvn sonar:sonar (Backend-spezifisch, überschreibt diese Werte)
#   - CI/CD:      Automatisch via Jenkinsfile / .gitlab-ci.yml
#
# Quality Gate Anforderungen (Banking-Standard):
#   - Code Coverage >= 70%
#   - Duplicated Lines < 5%
#   - Maintainability Rating: A
#   - Reliability Rating: A
#   - Security Rating: A
#   - Keine neuen kritischen/blockierenden Issues
#
# ==============================================================================

# --- Projekt-Identifikation ---------------------------------------------------
sonar.projectKey=research-portal
sonar.projectName=Research Portal
sonar.projectVersion=1.0.0-SNAPSHOT
sonar.organization=research-team

# --- Quellcode-Struktur (Multi-Modul) ----------------------------------------

# Module definieren
sonar.modules=backend,frontend

# Backend-Modul (Spring Boot / Java 17)
backend.sonar.projectName=Research Portal Backend
backend.sonar.projectBaseDir=backend
backend.sonar.sources=src/main/java
backend.sonar.tests=src/test/java
backend.sonar.java.source=17
backend.sonar.java.binaries=target/classes
backend.sonar.java.test.binaries=target/test-classes
backend.sonar.java.libraries=target/dependency/*.jar

# Backend Coverage (JaCoCo)
backend.sonar.java.coveragePlugin=jacoco
backend.sonar.coverage.jacoco.xmlReportPaths=target/site/jacoco/jacoco.xml
backend.sonar.junit.reportPaths=target/surefire-reports

# Backend Exclusions: DTOs, Config-Klassen, Entities (generierter Code via Lombok)
backend.sonar.exclusions=\
  **/dto/**,\
  **/config/**,\
  **/ResearchPortalApplication.java,\
  **/entity/*_.java

# Backend Test-Exclusions
backend.sonar.test.exclusions=\
  **/test/**

# Frontend-Modul (Angular 21 / TypeScript)
frontend.sonar.projectName=Research Portal Frontend
frontend.sonar.projectBaseDir=frontend
frontend.sonar.sources=src
frontend.sonar.tests=src
frontend.sonar.test.inclusions=**/*.spec.ts
frontend.sonar.sourceEncoding=UTF-8

# Frontend Exclusions
frontend.sonar.exclusions=\
  **/node_modules/**,\
  **/dist/**,\
  **/coverage/**,\
  **/*.spec.ts,\
  **/*.mock.ts,\
  **/test-setup.ts,\
  **/environments/**,\
  **/assets/**,\
  **/*.css,\
  **/*.scss

# Frontend TypeScript Konfiguration
frontend.sonar.typescript.lcov.reportPaths=coverage/lcov.info
frontend.sonar.typescript.tsconfigPath=tsconfig.json

# --- Globale Exclusions -------------------------------------------------------
sonar.exclusions=\
  **/node_modules/**,\
  **/dist/**,\
  **/target/**,\
  **/*.min.js,\
  **/*.min.css,\
  **/vendor/**,\
  **/.angular/**

# --- Encoding -----------------------------------------------------------------
sonar.sourceEncoding=UTF-8

# --- Quality Gate (Custom für Banking) ----------------------------------------
# Diese Werte werden im SonarQube-Server als Quality Gate konfiguriert.
# Hier dokumentiert als Referenz für das DevOps-Team.
#
# Bedingung                          | Schwellenwert | Operator
# -----------------------------------|---------------|----------
# Coverage on New Code               | 70%           | < (fail)
# Duplicated Lines on New Code       | 5%            | > (fail)
# Maintainability Rating on New Code | A             | != (fail)
# Reliability Rating on New Code     | A             | != (fail)
# Security Rating on New Code        | A             | != (fail)
# Security Hotspots Reviewed         | 100%          | < (fail)
# Blocker Issues                     | 0             | > (fail)
# Critical Issues                    | 0             | > (fail)

# --- Sprach-spezifische Regeln ------------------------------------------------

# Java: Zusätzliche Regeln für Banking-Kontext
# - SQL Injection Prevention (squid:S2077)
# - Hardcoded Credentials Detection (squid:S2068)
# - Logging sensitive Data (squid:S5145)
backend.sonar.issue.ignore.multicriteria=e1,e2
backend.sonar.issue.ignore.multicriteria.e1.ruleKey=java:S3457
backend.sonar.issue.ignore.multicriteria.e1.resourceKey=**/entity/**
backend.sonar.issue.ignore.multicriteria.e2.ruleKey=java:S1135
backend.sonar.issue.ignore.multicriteria.e2.resourceKey=**/*

# TypeScript: Angular-spezifische Ausnahmen
frontend.sonar.issue.ignore.multicriteria=e1
frontend.sonar.issue.ignore.multicriteria.e1.ruleKey=typescript:S1874
frontend.sonar.issue.ignore.multicriteria.e1.resourceKey=**/*.ts

# --- SCM (Git Integration) ---------------------------------------------------
sonar.scm.provider=git
sonar.scm.forceReloadAll=false

# --- Logging und Debugging ----------------------------------------------------
# sonar.verbose=true        # Nur für Debugging aktivieren
# sonar.log.level=DEBUG     # Nur für Debugging aktivieren
